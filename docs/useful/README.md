# 家具助手擴充功能

## 功能概述
這是一個專為新北市再生家具系統設計的 Chrome 擴充功能，提供多種實用功能來提升工作效率。

## 主要功能

### 1. 📈 年度統計
- 顯示年度和月份的資料統計
- 自動計算各時期的資料筆數
- 以彈出視窗形式呈現統計結果

### 2. 📥 資料匯出
- **輕量匯出**：匯出基本欄位（編號、名稱、行政區、建立日期）
- **全部匯出**：匯出完整資料包含所有欄位
- 支援 CSV 格式下載

### 3. 📂 資料面板
- 側邊面板顯示所有家具資料
- 支援 AutoID 搜尋功能
- 可預覽圖片和下載 JSON 檔案
- 包含圖片下載功能

### 4. 🖨️ 列印表格
- 生成格式化的列印頁面
- 包含完整的家具資訊
- 支援得標者資訊顯示

### 5. 📥 JSON 匯入功能（新增）
- 在編輯表單中匯入 JSON 檔案
- 自動填充表單欄位
- 支援 Element UI Select 元件的模擬點擊
- 完整的表單驗證功能

## JSON 匯入功能詳細說明

### 功能特點
- **自動填充**：根據 JSON 資料自動填充表單欄位
- **模擬點擊**：正確處理 Element UI Select 元件的類別和行政區欄位
- **事件觸發**：確保 Vue 組件狀態正確更新
- **驗證支援**：觸發表單驗證確保資料正確

### 使用方式
1. 點擊「新增」按鈕開啟編輯視窗
2. 在編輯視窗標題列會出現「匯入 JSON」按鈕
3. 點擊按鈕選擇 JSON 檔案
4. 系統會自動填充表單欄位

### JSON 格式要求
```json
{
  "AutoID": 2047,
  "Name": "E27 夾式筒燈 - 6",
  "CategoryName": "燈具、燈飾",
  "DistName": "新店區",
  "CreateDate": "2025-04-19T18:17:15.643",
  "Description": "產品描述...",
  "Length": 0,
  "Width": 0,
  "Height": 0,
  "DeliveryAddress": "新北市新店區薏仁坑路自強巷2-3號",
  "InitPrice": 20,
  "OriginPrice": 20,
  "Photos": [...]
}
```

### 支援的欄位映射
| 表單標籤 | JSON 欄位 | 說明 |
|---------|----------|------|
| 品名 | Name | 家具名稱 |
| 類別 | CategoryName | 家具類別 |
| 行政區 | DistName | 行政區名稱 |
| 產品描述 | Description | 產品詳細描述 |
| 長 | Length | 長度 |
| 寬 | Width | 寬度 |
| 高 | Height | 高度 |
| 交貨地點 | DeliveryAddress | 交貨地址 |
| 起標價格 | InitPrice | 起標價格 |
| 原價 | OriginPrice | 原價 |

### 技術實現
- **forceVueUpdate**：強制更新 Vue 組件狀態
- **validateFormData**：驗證表單資料完整性
- **fillForm**：核心填充邏輯，支援 Element UI Select 元件
- **insertImportButton**：動態插入匯入按鈕

### 模擬點擊流程
1. 找到 Element UI Select 元件
2. 找到下拉選單和選項
3. 點擊輸入框開啟下拉選單
4. 延遲 100ms 確保下拉選單完全開啟
5. 點擊匹配的選項
6. 觸發必要的事件

## 安裝方式
1. 下載擴充功能檔案
2. 開啟 Chrome 擴充功能管理頁面
3. 啟用開發者模式
4. 載入未封裝項目
5. 選擇擴充功能資料夾

## 使用注意事項
- 確保 JSON 檔案包含必要的 AutoID 和 Name 欄位
- 模擬點擊功能是解決 Element UI Select 驗證問題的關鍵
- 延遲時間（100ms）可能需要根據網路速度調整
- 建議在匯入前先備份現有資料

## 開發者功能
- 欄位分析：`window.postMessage({ source: 'run-vue-debug-fields' }, '*')`
- Payment 物件分析：`window.postMessage({ source: 'run-vue-payment-analysis' }, '*')`
- WinnerID 欄位分析：`window.postMessage({ source: 'run-vue-winner-analysis' }, '*')`
- 競標紀錄分析：`window.postMessage({ source: 'run-vue-bid-history-analysis' }, '*')`
- 自動點擊競標按鈕：`window.postMessage({ source: 'run-vue-auto-click-bid-button' }, '*')`
- **API端點分析**：`window.postMessage({ source: 'run-vue-api-endpoint-analysis' }, '*')`

## 技術架構
- **content.js**：主要功能實現，包含 UI 操作和資料處理
- **inject.js**：Vue 資料存取和事件處理
- **manifest.json**：擴充功能配置檔案

## API端點分析功能

### 功能概述
新增的API端點分析功能可以幫助找出競標紀錄的API端點，避免需要透過跳窗來取得資料。

### 主要功能
1. **Vue組件API分析** - 分析Vue實例中的API呼叫方法
2. **網路請求攔截** - 攔截fetch、XMLHttpRequest、axios請求
3. **頁面API端點搜尋** - 搜尋script標籤中的API端點
4. **Vue組件配置分析** - 分析Vue組件的API配置
5. **自動觸發測試** - 自動點擊競標紀錄按鈕觀察API呼叫

### 使用方式
1. 點擊「🔍 API端點分析」按鈕
2. 系統會自動分析並攔截所有網路請求
3. 自動點擊第一個競標紀錄按鈕
4. 在瀏覽器開發者工具的Console中查看分析結果

### 預期結果
- 找出競標紀錄的API端點URL
- 分析API請求的參數和回應格式
- 提供直接呼叫API的可行性評估

### 測試工具
- **test-api-analysis.html** - 模擬測試頁面
- **test-api-script.js** - 測試腳本
- **API_ANALYSIS_GUIDE.md** - 詳細使用指南

### 快速測試
1. 在瀏覽器Console中執行：
   ```javascript
   // 載入測試腳本
   fetch('test-api-script.js').then(r => r.text()).then(eval);
   
   // 執行快速測試
   quickTest();
   ```

2. 或開啟測試頁面：
   - 在瀏覽器中開啟 `test-api-analysis.html`
   - 點擊測試按鈕進行模擬測試

## 更新日誌
- 2025-01-XX：新增 API端點分析功能
- 2025-01-XX：新增 JSON 匯入功能
- 2025-01-XX：優化 Element UI Select 元件處理
- 2025-01-XX：增強表單驗證功能 

# 家具拍賣網後台管理系統 - 出價資料分析

## 專案概述

這是一個用於分析家具拍賣網後台管理系統中出價資料的Chrome擴充功能。主要目標是從Vue.js和Element UI組件中提取競標紀錄和出價資訊。

## 技術架構

### 前端技術
- **Vue.js** - 主要前端框架
- **Element UI** - UI組件庫
- **VXE Table** - 表格組件
- **VXE Modal** - 跳窗組件

### 擴充功能技術
- **Chrome Extension** - 瀏覽器擴充功能
- **Content Script** - 內容腳本注入
- **JavaScript** - 主要程式語言

## 功能模組

### 1. 資料分析功能
- **Vue資料分析** - 分析Vue實例中的資料結構
- **表格內容分析** - 分析VXE Table中的資料
- **跳窗內容分析** - 分析Modal中的出價紀錄
- **隱藏資料搜尋** - 搜尋隱藏的出價相關資料

### 2. 資料提取功能
- **統計功能** - 統計表格資料筆數
- **輕量匯出** - 匯出基本資料
- **全部匯出** - 匯出完整資料
- **資料面板** - 顯示資料面板
- **列印表格** - 列印表格功能

## 出價資料分析過程

### 問題背景
使用者需要分析家具拍賣網後台中的出價紀錄，特別是找出價格18元的顯示位置和相關的出價資訊。

### 分析步驟

#### 1. 初步探索
- 使用Vue DevTools分析Vue實例
- 搜尋Vue資料中的出價相關欄位
- 發現主表格中沒有顯示目前價格

#### 2. 表格結構分析
- 分析主表格（VXE Table）的結構
- 發現表格包含以下欄位：
  - 功能、競標紀錄、問答紀錄、待回覆數
  - 繳費資訊、預覽圖、編號、名稱
  - 行政區、類別、原價、起標價
  - 拍賣期間(起)、拍賣期間(迄)
  - 交貨地點、得標者、付款狀態、取貨狀態
  - 點擊率、追蹤數、建立日期

#### 3. 跳窗分析
- 發現出價資料在競標紀錄跳窗中
- 跳窗使用VXE Modal組件
- 跳窗標題：「出價紀錄」
- 跳窗類別：`edit-modal modal__maxheight vxe-modal--wrapper`

#### 4. 出價資料結構
在競標紀錄跳窗中發現的資料結構：
```
表頭：出價人 | 價格 | 出價時間
資料：Tank (animegg) | 18 | 2025-07-07 15:54
```

#### 5. 價格顯示位置
18元價格的具體顯示位置：
- **標籤**: `TD` (表格欄位)
- **類別**: `vxe-body--column col_26 col--right col--ellipsis`
- **容器**: `DIV` 類別 `vxe-cell c--tooltip`
- **內容**: 純數字 `"18"`

### 重要發現

#### 1. 資料存取方式
- ❌ **無法不跳窗直接取得出價資料**
- ✅ **需要點擊競標紀錄按鈕開啟跳窗**
- ✅ **出價資料是動態載入的，不在前端快取**

#### 2. 資料來源分析
- 沒有在localStorage/sessionStorage中找到出價資料
- 沒有在全域變數中找到出價資料
- 沒有在隱藏DOM元素中找到出價資料
- 出價資料需要透過API呼叫取得

#### 3. 表格結構特點
- 主表格只顯示基本資訊（原價、起標價）
- 目前價格和出價紀錄在跳窗中顯示
- 使用VXE Table組件，支援複雜的表格功能

## 技術挑戰與限制

### 1. 動態資料載入
- 出價資料不是預先載入的
- 需要觸發特定操作才會載入資料
- 無法透過靜態分析取得完整資料

### 2. Vue組件封裝
- 資料被封裝在Vue組件中
- 需要理解Vue的資料綁定機制
- 組件狀態管理複雜

### 3. 跳窗依賴
- 出價資料依賴跳窗顯示
- 無法直接從主頁面取得
- 需要模擬使用者操作

## 解決方案建議

### 1. 自動化操作
- 自動點擊競標紀錄按鈕
- 等待跳窗出現和資料載入
- 自動擷取跳窗中的資料

### 2. API攔截
- 監聽網路請求
- 攔截出價資料的API呼叫
- 直接從API回應中取得資料

### 3. Vue實例分析
- 深入分析Vue組件的資料結構
- 尋找可能的資料來源
- 理解資料流動機制

## 結論

### 主要發現
1. **出價資料位置**：在競標紀錄跳窗的表格中
2. **價格顯示**：18元顯示在TD標籤中，類別為`vxe-body--column col_26`
3. **資料存取**：需要點擊按鈕開啟跳窗才能取得
4. **技術限制**：無法不跳窗直接取得出價資料

### 技術建議
1. 使用自動化腳本點擊按鈕
2. 監聽API請求取得資料
3. 分析Vue組件的資料結構
4. 考慮使用Chrome DevTools Protocol

### 未來改進
1. 開發更穩定的自動化操作
2. 實現API請求攔截功能
3. 優化資料提取效率
4. 增加錯誤處理機制

## 檔案結構

```
furniture-helper/
├── manifest.json          # 擴充功能配置
├── content.js             # 主要內容腳本
├── inject.js              # 注入腳本
├── icon.png               # 擴充功能圖示
└── README.md              # 說明文件
```

## 使用說明

### 安裝擴充功能
1. 開啟Chrome瀏覽器
2. 進入擴充功能管理頁面
3. 開啟開發者模式
4. 載入未封裝項目
5. 選擇furniture-helper資料夾

### 使用分析功能
1. 進入家具拍賣網後台
2. 開啟開發者工具Console
3. 執行分析指令：
   ```javascript
   window.postMessage({ source: 'run-vue-data-analysis' }, '*');
   ```

### 注意事項
- 需要先登入後台系統
- 確保頁面完全載入後再執行分析
- 某些功能可能需要手動操作配合

## 版本歷史

### v1.0.0
- 初始版本
- 基本Vue資料分析功能
- 表格內容分析
- 跳窗內容分析
- 出價資料位置識別

---

**最後更新**: 2025-01-27
**分析結論**: 出價資料需要透過跳窗取得，無法直接從主頁面提取 