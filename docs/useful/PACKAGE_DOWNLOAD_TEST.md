# 打包下載功能測試指南

## 測試環境準備

1. 確保 Chrome 擴充功能已正確載入
2. 前往新北市再生家具網站：https://recycledstuff.ntpc.gov.tw/BidMgr/
3. 確保已登入並能看到商品列表

## 測試步驟

### 1. 基本功能測試

1. **開啟資料面板**
   - 點擊擴充功能按鈕中的「📂 資料面板」
   - 確認面板正常開啟並顯示商品列表

2. **檢查按鈕顯示**
   - 確認每個商品項目旁邊都有兩個按鈕：
     - 藍色的「下載」按鈕
     - 綠色的「打包下載」按鈕

### 2. 打包下載測試

1. **選擇測試商品**
   - 選擇一個有圖片的商品進行測試
   - 建議選擇圖片數量較少的商品（1-3張）先進行測試

2. **執行打包下載**
   - 點擊該商品的「打包下載」按鈕
   - 觀察按鈕狀態變化：
     - 文字應變為「處理中...」
     - 按鈕應變為灰色且不可點擊

3. **檢查下載結果**
   - 等待處理完成（時間取決於圖片數量和大小）
   - 確認瀏覽器自動下載了 `商品名稱_package.json` 檔案
   - 按鈕應恢復原始狀態

### 3. 檔案內容驗證

1. **開啟下載的 JSON 檔案**
   - 使用文字編輯器開啟下載的 JSON 檔案
   - 確認檔案結構正確

2. **檢查 JSON 內容**
   - 確認包含所有商品資訊（AutoID、Name、CategoryName 等）
   - 確認 Photos 陣列中的圖片已轉換為 Base64 格式
   - 確認 ExportInfo 區段包含正確的匯出資訊

3. **驗證 Base64 圖片**
   - 複製 Photos 陣列中某張圖片的 Base64 資料
   - 在瀏覽器中開啟 `data:image/jpeg;base64,` + Base64 字串
   - 確認圖片能正常顯示

### 4. 錯誤處理測試

1. **測試無圖片商品**
   - 選擇一個沒有圖片的商品
   - 點擊「打包下載」按鈕
   - 確認能正常下載（Photos 陣列為空）

2. **測試網路問題**
   - 在處理過程中暫時斷開網路連線
   - 確認錯誤處理機制正常運作
   - 確認按鈕狀態能正確恢復

### 5. 效能測試

1. **多圖片商品測試**
   - 選擇一個有多張圖片（5張以上）的商品
   - 測試處理時間和記憶體使用情況
   - 確認不會造成瀏覽器卡頓

2. **連續下載測試**
   - 連續點擊多個商品的「打包下載」按鈕
   - 確認每個下載任務能獨立完成
   - 確認不會相互干擾

## 預期結果

### 成功情況
- ✅ 按鈕狀態正確變化
- ✅ 成功下載 JSON 檔案
- ✅ JSON 檔案包含完整的商品資訊和 Base64 圖片
- ✅ 檔案命名格式正確（商品名稱_package.json）
- ✅ 按鈕狀態正確恢復

### 可能的問題
- ❌ 圖片轉換失敗：檢查網路連線和圖片 URL 是否有效
- ❌ 下載失敗：檢查瀏覽器下載設定
- ❌ 按鈕狀態異常：檢查 JavaScript 錯誤

## 除錯指令

在瀏覽器控制台（F12 → Console）中執行以下指令來檢查資料：

```javascript
// 檢查當前資料
console.log('當前資料筆數:', window.__tableFullData?.length);

// 檢查某筆資料的圖片
const sampleData = window.__tableFullData?.[0];
if (sampleData) {
  console.log('範例資料:', sampleData);
  console.log('圖片數量:', sampleData.Photos?.length);
  console.log('圖片URL:', sampleData.Photos?.map(p => p.Photo));
}
```

## 注意事項

1. **網路連線**：確保網路連線穩定，圖片轉換需要下載圖片
2. **瀏覽器設定**：確保瀏覽器允許下載檔案
3. **記憶體使用**：大量圖片轉換可能消耗較多記憶體
4. **處理時間**：圖片轉換需要時間，請耐心等待
5. **檔案大小**：Base64 編碼會增加檔案大小約 33% 