# 🚀 一鍵匯入功能完整說明

## 功能概述

一鍵匯入功能是一個強大的資料匯入工具，可以將包含 Base64 圖片的 JSON 檔案直接送到伺服器，無需手動填寫表單或處理圖片上傳。這個功能完全繞過了前端驗證機制，直接與後端 API 通訊。

## 主要特色

- ✅ **完全自動化**：選擇 JSON 檔案後自動處理所有步驟
- ✅ **圖片處理**：自動將 Base64 圖片轉換並上傳到伺服器
- ✅ **繞過驗證**：直接呼叫後端 API，避免前端驗證問題
- ✅ **表格更新**：成功後自動重新整理表格顯示最新資料
- ✅ **錯誤處理**：完整的錯誤處理和使用者提示

## 使用流程

### 1. 準備 JSON 檔案
JSON 檔案必須包含以下必要欄位：
```json
{
  "Name": "家具名稱",
  "CategoryID": 13,
  "DistID": "231",
  "Description": "產品描述",
  "InitPrice": "1000",
  "OriginPrice": "2000",
  "DeliveryAddress": "交貨地點",
  "Length": "100",
  "Width": "50",
  "Height": "80",
  "Photos": [
    {
      "Photo": "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQ..."
    }
  ]
}
```

### 2. 觸發一鍵匯入
1. 在網站主頁面找到「🚀 一鍵匯入」按鈕
2. 點擊按鈕會彈出檔案選擇器
3. 選擇包含 Base64 圖片的 JSON 檔案

### 3. 自動處理流程
系統會自動執行以下步驟：
1. **檔案讀取**：解析 JSON 檔案內容
2. **資料驗證**：檢查必要欄位是否存在
3. **圖片處理**：將 Base64 圖片轉換為檔案格式
4. **圖片上傳**：使用正確的 API 上傳圖片到伺服器
5. **資料送出**：將完整資料送到產品新增 API
6. **表格更新**：觸發查詢按鈕重新載入表格

## 技術實作

### API 端點
- **圖片上傳**：`/BidMgr/api/Product/UploadFile`
- **產品新增**：`/BidMgr/api/Product/AddProduct`

### 核心函數

#### `directSubmitToAPI(jsonData)`
主要的 API 送出函數，負責：
- 準備 API payload
- 處理圖片上傳
- 送出產品資料
- 處理回應和錯誤

#### `uploadImagesWithCorrectAPI(photos)`
圖片上傳處理函數，負責：
- 將 Base64 圖片轉換為 File 物件
- 使用 FormData 上傳圖片
- 取得上傳後的圖片 URL

#### `base64ToFile(base64String, filename)`
Base64 轉換函數，負責：
- 將 Base64 字串轉換為 File 物件
- 設定正確的檔案名稱和 MIME 類型

### 表格更新機制
成功送出後，系統會：
1. 延遲 2 秒讓使用者看到成功訊息
2. 尋找頁面上的查詢按鈕
3. 觸發查詢按鈕的點擊事件
4. 重新載入表格資料

## 使用方法

### 基本使用
1. 確保 JSON 檔案格式正確
2. 點擊「🚀 一鍵匯入」按鈕
3. 選擇 JSON 檔案
4. 等待處理完成

### 進階使用
- **大量匯入**：可以重複使用此功能匯入多個檔案
- **批次處理**：配合打包下載功能，實現完整的備份還原流程

## 注意事項

### 檔案格式要求
- ✅ 必須是有效的 JSON 格式
- ✅ 必須包含 `Name` 和 `Photos` 欄位
- ✅ 圖片必須是 Base64 格式（以 `data:image/` 開頭）

### 網路要求
- ✅ 需要穩定的網路連線
- ✅ 伺服器 API 必須正常運作
- ✅ 圖片上傳可能需要較長時間

### 錯誤處理
- ❌ 檔案格式錯誤會顯示錯誤訊息
- ❌ 網路錯誤會顯示具體錯誤原因
- ❌ API 錯誤會顯示伺服器回應

### 限制
- ⚠️ 圖片大小可能有限制
- ⚠️ 同時只能處理一個檔案
- ⚠️ 需要等待前一個處理完成

## 常見問題

### Q: 為什麼需要 Base64 格式的圖片？
A: Base64 格式可以將圖片資料直接嵌入 JSON 檔案中，實現單一檔案包含所有資料，便於備份和傳輸。

### Q: 如果圖片上傳失敗怎麼辦？
A: 系統會顯示具體的錯誤訊息，通常是網路問題或伺服器問題，請檢查網路連線或稍後重試。

### Q: 可以一次匯入多個檔案嗎？
A: 目前一次只能處理一個檔案，但可以重複使用此功能來匯入多個檔案。

### Q: 表格沒有更新怎麼辦？
A: 如果表格沒有自動更新，可以手動點擊查詢按鈕來重新載入資料。

## 除錯資訊

### 控制台訊息
系統會在瀏覽器控制台顯示詳細的處理過程：
- `🚀 開始一鍵匯入流程...`
- `📁 選擇檔案: filename.json`
- `📋 JSON 資料解析成功，開始處理...`
- `📤 處理 X 張圖片...`
- `✅ API 送出成功`
- `🔄 觸發查詢按鈕以重新載入表格資料...`

### 錯誤訊息
常見錯誤訊息及解決方法：
- `❌ JSON 格式不符合要求`：檢查 JSON 檔案格式
- `❌ API 送出失敗`：檢查網路連線和伺服器狀態
- `❌ 查詢按鈕未找到`：頁面可能未完全載入

## 未來改進

### 計劃中的功能
- [ ] 支援批次匯入多個檔案
- [ ] 增加進度條顯示處理進度
- [ ] 支援更多圖片格式
- [ ] 增加資料驗證和預覽功能

### 效能優化
- [ ] 圖片壓縮功能
- [ ] 並行上傳多張圖片
- [ ] 快取機制減少重複上傳

---

**版本**：1.0  
**最後更新**：2024年7月  
**作者**：家具助手開發團隊 