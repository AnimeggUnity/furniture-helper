# 自動裁切功能測試指南

## 測試目標

驗證自動裁切功能能夠正確處理網站內建的圖片裁切介面，實現完全自動化的圖片上傳流程。

## 測試環境準備

### 1. 基本要求
- ✅ Chrome 瀏覽器（88.0 或更新版本）
- ✅ 已安裝並啟用擴充功能
- ✅ 已登入新北市再生家具網站
- ✅ 有編輯權限

### 2. 測試資料準備
- 📦 準備一個包含 Base64 圖片的 `_packaged.json` 檔案
- 📷 確保 JSON 中包含 2-4 張圖片（測試不同數量）
- 🔍 確認圖片格式為 JPEG 或 PNG

## 測試步驟

### 階段 1：基本功能測試

#### 1.1 開啟編輯視窗
1. 前往 https://recycledstuff.ntpc.gov.tw/BidMgr/
2. 點擊「新增」按鈕開啟編輯視窗
3. 確認表單正常載入
4. 檢查「匯入 JSON」按鈕是否存在

#### 1.2 執行一鍵上傳
1. 點擊「匯入 JSON」按鈕
2. 選擇準備好的 `_packaged.json` 檔案
3. 觀察控制台日誌輸出

### 階段 2：圖片上傳驗證

#### 2.1 檢查上傳進度
```javascript
// 預期的控制台日誌
📥 開始匯入 JSON 資料...
🖼️ 檢測到 4 張圖片，開始處理圖片上傳...
📦 檢測到打包的 JSON，開始上傳 Base64 圖片...
🚀 開始批量上傳 4 張圖片...
📤 處理第 1/4 張圖片: upload_1.jpg
✅ Base64 轉 File 成功: upload_1.jpg (101045 bytes, type: image/jpeg)
📤 開始上傳圖片: upload_1.jpg (101045 bytes)
✅ 圖片上傳成功，伺服器回應: https://recycledstuff.ntpc.gov.tw/Static/Image/Upload/Product/xxx.jpg
```

#### 2.2 檢查預覽建立
```javascript
// 預期的控制台日誌
🖼️ 建立圖片預覽: upload_1.jpg -> https://recycledstuff.ntpc.gov.tw/Static/Image/Upload/Product/xxx.jpg
✅ 找到預覽圖欄位
✅ 找到 file input
✅ 成功設定 file input: upload_1.jpg
✅ 視覺預覽建立完成: upload_1.jpg
```

### 階段 3：自動裁切測試

#### 3.1 檢查裁切介面檢測
```javascript
// 預期的控制台日誌
🔍 所有圖片處理完成，檢查是否需要處理裁切介面...
🔍 檢查是否有圖片裁切介面...
```

#### 3.2 驗證自動處理
如果發現裁切介面：
```javascript
// 預期的控制台日誌
✅ 發現裁切介面，嘗試自動處理...
✅ 找到確認按鈕，自動點擊完成裁切
```

如果沒有裁切介面：
```javascript
// 預期的控制台日誌
✅ 沒有發現需要處理的裁切介面或彈窗
```

### 階段 4：完成驗證

#### 4.1 檢查最終狀態
- ✅ 所有文字欄位正確填入
- ✅ 所有圖片預覽正確顯示
- ✅ 沒有裁切介面或彈窗阻擋
- ✅ 表單可以正常提交

#### 4.2 驗證表單提交
1. 嘗試點擊「確定」或「提交」按鈕
2. 確認沒有驗證錯誤
3. 檢查是否成功保存

## 測試案例

### 案例 1：單張圖片測試
**目標**：驗證單張圖片的自動裁切處理
**步驟**：
1. 準備包含 1 張圖片的 JSON 檔案
2. 執行一鍵上傳
3. 觀察裁切處理過程
4. 驗證最終結果

**預期結果**：
- 圖片成功上傳
- 預覽正確顯示
- 自動處理裁切（如果有）
- 表單可以提交

### 案例 2：多張圖片測試
**目標**：驗證多張圖片的批量處理
**步驟**：
1. 準備包含 3-4 張圖片的 JSON 檔案
2. 執行一鍵上傳
3. 觀察批量處理過程
4. 驗證所有圖片處理完成

**預期結果**：
- 所有圖片成功上傳
- 所有預覽正確顯示
- 自動處理所有裁切介面
- 表單可以提交

### 案例 3：無裁切介面測試
**目標**：驗證沒有裁切介面時的正常流程
**步驟**：
1. 準備測試用的 JSON 檔案
2. 執行一鍵上傳
3. 觀察是否檢測到裁切介面
4. 驗證正常完成

**預期結果**：
- 圖片成功上傳
- 預覽正確顯示
- 沒有裁切介面檢測
- 正常完成流程

### 案例 4：錯誤處理測試
**目標**：驗證錯誤情況的處理
**步驟**：
1. 準備包含無效圖片的 JSON 檔案
2. 執行一鍵上傳
3. 觀察錯誤處理
4. 驗證部分成功

**預期結果**：
- 有效圖片成功上傳
- 無效圖片被跳過
- 錯誤日誌正確記錄
- 部分功能正常

## 除錯指令

### 1. 手動觸發裁切處理
```javascript
// 在瀏覽器控制台中執行
handleImageCropping();
```

### 2. 檢查裁切介面狀態
```javascript
// 檢查是否有裁切相關元素
console.log('裁切模態框:', document.querySelector('.cropper-modal'));
console.log('裁切容器:', document.querySelector('.cropper-container'));
console.log('可見按鈕:', document.querySelectorAll('button:visible'));
```

### 3. 檢查圖片預覽狀態
```javascript
// 檢查圖片預覽元素
console.log('預覽容器:', document.querySelector('.image-preview-container'));
console.log('預覽項目:', document.querySelectorAll('.el-upload-list__item'));
console.log('File inputs:', document.querySelectorAll('input[type="file"]'));
```

### 4. 檢查表單狀態
```javascript
// 檢查表單驗證狀態
console.log('表單元素:', document.querySelector('.vxe-modal--box .el-form'));
console.log('必填欄位:', document.querySelectorAll('.el-form-item.is-required'));
console.log('驗證錯誤:', document.querySelectorAll('.el-form-item__error'));
```

## 常見問題

### Q1: 裁切介面沒有被檢測到
**可能原因**：
- 裁切庫使用不同的 CSS 類名
- 裁切介面延遲載入
- DOM 結構發生變化

**解決方案**：
1. 檢查控制台日誌
2. 手動觸發 `handleImageCropping()`
3. 檢查裁切庫的 DOM 結構

### Q2: 按鈕點擊無效
**可能原因**：
- 按鈕被其他元素遮擋
- 按鈕需要特定的事件觸發
- 按鈕狀態不正確

**解決方案**：
1. 檢查按鈕的可見性
2. 嘗試不同的點擊方法
3. 檢查按鈕的狀態

### Q3: 處理不完整
**可能原因**：
- 檢查間隔時間太短
- 動態載入的內容
- 網路延遲

**解決方案**：
1. 增加檢查間隔時間
2. 等待動態內容載入
3. 檢查網路連線

## 測試報告模板

### 測試環境
- **瀏覽器版本**：Chrome XX.XX.XXXX.XX
- **擴充功能版本**：1.0
- **測試日期**：YYYY-MM-DD
- **測試人員**：XXX

### 測試結果
- **基本功能**：✅ 通過 / ❌ 失敗
- **圖片上傳**：✅ 通過 / ❌ 失敗
- **預覽建立**：✅ 通過 / ❌ 失敗
- **自動裁切**：✅ 通過 / ❌ 失敗
- **表單提交**：✅ 通過 / ❌ 失敗

### 發現問題
1. **問題描述**：
2. **重現步驟**：
3. **預期結果**：
4. **實際結果**：
5. **嚴重程度**：高/中/低

### 建議改進
1. **功能改進**：
2. **使用者體驗**：
3. **效能優化**：

## 總結

自動裁切功能測試是確保一鍵上傳功能完整性的重要環節。通過系統性的測試，可以驗證功能在不同情況下的穩定性和可靠性，為使用者提供更好的體驗。 