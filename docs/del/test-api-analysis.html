<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API端點分析測試</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .console-output {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        .api-info {
            background: #e7f3ff;
            border-left: 4px solid #007bff;
            padding: 15px;
            margin: 15px 0;
        }
        .mock-api {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔍 API端點分析測試頁面</h1>
        
        <div class="api-info">
            <h3>📋 測試說明</h3>
            <p>這個頁面模擬了家具拍賣網的環境，包含：</p>
            <ul>
                <li>Vue.js組件結構</li>
                <li>模擬的API端點</li>
                <li>競標紀錄按鈕</li>
                <li>網路請求攔截</li>
            </ul>
        </div>

        <div class="test-section">
            <h3>🎯 模擬競標紀錄按鈕</h3>
            <button class="test-button" onclick="simulateBidButton()">
                🔍 競標紀錄
            </button>
            <button class="test-button" onclick="simulateBidButtonWithAPI()">
                🔍 競標紀錄 (含API呼叫)
            </button>
        </div>

        <div class="test-section">
            <h3>🌐 模擬API端點</h3>
            <div class="mock-api">
                <strong>GET /api/bid/history/{id}</strong> - 取得競標紀錄
            </div>
            <div class="mock-api">
                <strong>POST /api/bid/search</strong> - 搜尋競標資料
            </div>
            <div class="mock-api">
                <strong>GET /api/furniture/{id}/bids</strong> - 取得家具出價紀錄
            </div>
        </div>

        <div class="test-section">
            <h3>📊 Console輸出</h3>
            <div id="console-output" class="console-output">
                等待測試開始...
            </div>
            <button class="test-button" onclick="clearConsole()">清除輸出</button>
        </div>

        <div class="test-section">
            <h3>🔧 手動測試指令</h3>
            <p>在瀏覽器Console中執行以下指令：</p>
            <div class="console-output">
// 觸發API端點分析
window.postMessage({ source: 'run-vue-api-endpoint-analysis' }, '*');

// 觸發競標紀錄分析
window.postMessage({ source: 'run-vue-bid-history-analysis' }, '*');

// 自動點擊競標按鈕
window.postMessage({ source: 'run-vue-auto-click-bid-button' }, '*');
            </div>
        </div>
    </div>

    <script>
        // 模擬Vue組件
        class MockVueComponent {
            constructor() {
                this.$data = {
                    bidHistory: [],
                    apiEndpoint: '/api/bid/history',
                    furnitureId: 12345
                };
                this.$options = {
                    methods: {
                        fetchBidHistory: function(id) {
                            console.log('🎯 Vue方法: fetchBidHistory 被呼叫，參數:', id);
                            return fetch(`/api/bid/history/${id}`);
                        },
                        searchBids: function(params) {
                            console.log('🎯 Vue方法: searchBids 被呼叫，參數:', params);
                            return fetch('/api/bid/search', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify(params)
                            });
                        }
                    }
                };
            }
        }

        // 模擬Vue實例
        const mockVue = new MockVueComponent();
        document.body.__vue__ = mockVue;

        // 模擬競標紀錄按鈕
        function simulateBidButton() {
            logToConsole('🔍 模擬競標紀錄按鈕點擊');
            
            // 模擬跳窗出現
            setTimeout(() => {
                logToConsole('✅ 跳窗已出現');
                logToConsole('📋 跳窗內容: 出價紀錄表格');
                logToConsole('💰 找到價格: 18元');
                logToConsole('👤 出價人: Tank (animegg)');
                logToConsole('⏰ 出價時間: 2025-07-07 15:54');
            }, 500);
        }

        // 模擬競標紀錄按鈕（含API呼叫）
        function simulateBidButtonWithAPI() {
            logToConsole('🔍 模擬競標紀錄按鈕點擊（含API呼叫）');
            
            // 模擬API呼叫
            setTimeout(() => {
                logToConsole('🌐 發送API請求: GET /api/bid/history/12345');
                logToConsole('📦 請求參數: { furnitureId: 12345 }');
                
                // 模擬API回應
                setTimeout(() => {
                    logToConsole('✅ API回應收到');
                    logToConsole('📋 回應資料:');
                    logToConsole('  - 出價人: Tank (animegg)');
                    logToConsole('  - 價格: 18');
                    logToConsole('  - 時間: 2025-07-07T15:54:00Z');
                    logToConsole('  - 狀態: 成功');
                }, 300);
            }, 200);
        }

        // 攔截fetch請求
        const originalFetch = window.fetch;
        window.fetch = function(...args) {
            const url = args[0];
            const options = args[1] || {};
            
            logToConsole(`🌐 Fetch請求: ${options.method || 'GET'} ${url}`);
            
            if (typeof url === 'string' && 
                (url.includes('bid') || url.includes('history') || url.includes('api'))) {
                logToConsole(`🎯 發現競標相關API請求: ${url}`);
            }
            
            return originalFetch.apply(this, args);
        };

        // 攔截XMLHttpRequest
        const originalXHROpen = XMLHttpRequest.prototype.open;
        const originalXHRSend = XMLHttpRequest.prototype.send;
        
        XMLHttpRequest.prototype.open = function(method, url, ...args) {
            this._method = method;
            this._url = url;
            return originalXHROpen.apply(this, [method, url, ...args]);
        };
        
        XMLHttpRequest.prototype.send = function(data) {
            logToConsole(`🌐 XHR請求: ${this._method} ${this._url}`);
            
            if (typeof this._url === 'string' && 
                (this._url.includes('bid') || this._url.includes('history') || this._url.includes('api'))) {
                logToConsole(`🎯 發現競標相關XHR請求: ${this._url}`);
            }
            
            return originalXHRSend.apply(this, [data]);
        };

        // Console輸出函數
        function logToConsole(message) {
            const consoleOutput = document.getElementById('console-output');
            const timestamp = new Date().toLocaleTimeString();
            consoleOutput.innerHTML += `[${timestamp}] ${message}<br>`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
            
            // 同時輸出到瀏覽器Console
            console.log(message);
        }

        // 清除Console輸出
        function clearConsole() {
            document.getElementById('console-output').innerHTML = 'Console已清除...';
        }

        // 監聽postMessage
        window.addEventListener('message', event => {
            if (event.source !== window) return;
            
            const source = event.data?.source;
            if (source === 'run-vue-api-endpoint-analysis') {
                logToConsole('🔍 開始API端點分析...');
                
                // 模擬Vue實例分析
                setTimeout(() => {
                    logToConsole('📋 步驟1: 分析Vue組件中的API呼叫');
                    logToConsole('✅ 找到 1 個Vue實例');
                    logToConsole('🎯 發現API方法: fetchBidHistory');
                    logToConsole('🎯 發現API方法: searchBids');
                    logToConsole('🎯 發現API相關資料: apiEndpoint = /api/bid/history');
                }, 500);
                
                // 模擬API端點搜尋
                setTimeout(() => {
                    logToConsole('📋 步驟3: 分析頁面中的API端點');
                    logToConsole('🎯 發現API端點: /api/bid/history/{id}');
                    logToConsole('🎯 發現API端點: /api/bid/search');
                    logToConsole('🎯 發現API端點: /api/furniture/{id}/bids');
                }, 1000);
                
                // 模擬按鈕點擊
                setTimeout(() => {
                    logToConsole('📋 步驟5: 觸發競標紀錄按鈕點擊');
                    logToConsole('🎯 點擊競標紀錄按鈕...');
                    simulateBidButtonWithAPI();
                }, 1500);
            }
        });

        // 頁面載入完成
        window.addEventListener('load', () => {
            logToConsole('✅ 測試頁面載入完成');
            logToConsole('🔧 網路請求攔截器已設定');
            logToConsole('💡 請點擊上方按鈕或使用Console指令進行測試');
        });
    </script>
</body>
</html> 